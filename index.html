<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Succession - Diagnostic Gratuit</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }
        .container { 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px; 
            width: 90%; 
            overflow: hidden;
            animation: slideUp 0.8s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .header { 
            background: linear-gradient(135deg, #ff6b6b, #feca57); 
            padding: 30px; 
            text-align: center; 
            color: white;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .header p { opacity: 0.95; font-size: 1.1em; }
        .content { padding: 40px; }
        .question { display: none; animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .question.active { display: block; }
        label { display: block; margin: 20px 0; padding: 15px; border-radius: 12px; border: 2px solid #eee; cursor: pointer; transition: all 0.3s; }
        label:hover { background: #f8f9fa; border-color: #667eea; transform: translateY(-2px); }
        input[type="radio"] { margin-right: 12px; transform: scale(1.3); }
        input[type="text"], input[type="tel"] { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; margin: 10px 0; transition: border-color 0.3s; }
        input[type="text"]:focus, input[type="tel"]:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .progress { background: #eee; height: 8px; border-radius: 4px; margin: 30px 0; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, #ff6b6b, #feca57); height: 100%; transition: width 0.5s ease; border-radius: 4px; }
        button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 18px 40px; border-radius: 12px; font-size: 1.1em; cursor: pointer; width: 100%; margin: 20px 0; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .thank-you { text-align: center; padding: 40px 20px; }
        .thank-you h2 { color: #27ae60; font-size: 2em; margin-bottom: 20px; }
        .score { font-size: 3.5em; font-weight: bold; background: linear-gradient(135deg, #27ae60, #2ecc71); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 20px 0; }
        @media (max-width: 480px) { .content { padding: 30px 20px; } .header h1 { font-size: 1.8em; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Diagnostic Succession</h1>
            <p>√âvaluez votre situation patrimoniale en 2 min</p>
        </div>
        <div class="content">
            <div class="progress"><div class="progress-bar" id="progress"></div></div>
            
            <!-- Intro -->
            <div id="intro" class="question active">
                <h2>Bonjour ! üëã</h2>
                <p>Ce diagnostic gratuit identifie les points cl√©s de votre succession.</p>
                <input type="text" id="fullName" placeholder="Votre nom complet" required>
                <input type="tel" id="phone" placeholder="Votre t√©l√©phone">
                <button onclick="startQuiz()">Commencer le diagnostic</button>
            </div>

            <!-- Questions -->
            <div id="q1" class="question">
                <h2>1. Votre sentiment actuel ?</h2>
                <label><input type="radio" name="q1" value="anxieux"> üòü Anxieux¬∑se</label>
                <label><input type="radio" name="q1" value="neutre"> üòê Neutre</label>
                <label><input type="radio" name="q1" value="confiant"> üòä Confiant¬∑e</label>
                <button onclick="nextQuestion()">Suivant</button>
            </div>

            <div id="q2" class="question">
                <h2>2. Nombre d'h√©ritiers ?</h2>
                <label><input type="radio" name="q2" value="1"> üë§ 1</label>
                <label><input type="radio" name="q2" value="2-3"> üë• 2-3</label>
                <label><input type="radio" name="q2" value="4+"> üë™ 4+</label>
                <button onclick="nextQuestion()">Suivant</button>
            </div>

            <!-- ... Autres questions q3-q7 similaires ... -->
            <div id="q7" class="question">
                <h2>7. Avez-vous consult√© ?</h2>
                <label><input type="radio" name="q7" value="non"> ‚ùå Jamais</label>
                <label><input type="radio" name="q7" value="partiel"> ‚ö†Ô∏è Partiellement</label>
                <label><input type="radio" name="q7" value="oui"> ‚úÖ Oui complet</label>
                <button onclick="showResults()">Voir mon diagnostic</button>
            </div>

            <!-- Merci -->
            <div id="thankyou" class="question">
                <div class="thank-you">
                    <h2>‚úÖ Diagnostic termin√© !</h2>
                    <div class="score" id="score">85%</div>
                    <p>Vos r√©sultats ont √©t√© enregistr√©s. Un conseiller vous rappelle sous 24h.</p>
                    <button onclick="location.reload()">Refaire</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 1;
        let answers = {};
        let fullName = '';
        let phone = '';
        let address = '';

        function updateProgress() {
            const progress = (currentQuestion / 8) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function startQuiz() {
            fullName = document.getElementById('fullName').value.trim();
            phone = document.getElementById('phone').value.trim();
            address = ''; // √Ä ajouter si champ
            
            if (!fullName || !phone) {
                alert('Nom et t√©l√©phone requis');
                return;
            }
            
            document.getElementById('intro').classList.remove('active');
            document.getElementById('q1').classList.add('active');
            currentQuestion = 1;
            updateProgress();
        }

        function nextQuestion() {
            const radios = document.querySelector(`#q${currentQuestion} input[type="radio"]:checked`);
            if (!radios) return alert('S√©lectionnez une r√©ponse');
            
            answers[`q${currentQuestion}`] = radios.value;
            currentQuestion++;
            
            if (currentQuestion > 7) return;
            
            document.getElementById(`q${currentQuestion-1}`).classList.remove('active');
            document.getElementById(`q${currentQuestion}`).classList.add('active');
            updateProgress();
        }

        async function showResults() {
            // Calcule score (exemple)
            const score = Math.floor(Math.random() * 30) + 70; // 70-100%
            
            document.getElementById('score').textContent = score + '%';
            
            // SAUVEGARDE BACKEND - TRY-CATCH FIX LIGNES 609/648
            try {
                const response = await fetch('https://quiz-succession-serenite.onrender.com/results', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        json: {
                            fullName, phone, address,
                            q1_sentiment: answers.q1 || null,
                            q2_heirs: answers.q2 || null,
                            q3_property_state: answers.q3 || null,
                            q4_family_discussion: answers.q4 || null,
                            q5_timeline: answers.q5 || null,
                            q6_obstacle: answers.q6 || null,
                            q7_consultation: answers.q7 || null
                        }
                    })
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                console.log('‚úÖ Sauvegard√©:', data);
                
            } catch (error) {
                console.error('‚ùå Submit erreur:', error);
                // Continue m√™me si backend down
            }
            
            // Cache questions
            Array.from(document.querySelectorAll('.question')).forEach(q => q.classList.remove('active'));
            document.getElementById('thankyou').classList.add('active');
        }
    </script>
</body>
</html>
